_target_: nuplan_zigned.simulation.models.ritp_planner_model.RITPPlannerModel
_convert_: 'all'
model_name: ritp_planner_model
ritp_planner_model_params:
  _target_: nuplan_zigned.simulation.models.ritp_planner_model.RITPPlannerModelParams
  _convert_: 'all'
  finetune_range: full
  hybrid_driven: false
  frenet_radius: 100
  num_plans: 1
  num_modes_for_eval: 2
  step_interval_for_eval: 2
  acc_limit: 2.4  # 1.5, 3.0
  acc_exponent: 10
  dec_limit: 3.0
  time_headway: 1.5
  safety_margin: 4.0 # 2.0
  use_rule_based_refine: true
  map_location: 'cpu'


ritp_planner_feature_params:
  _target_: nuplan_zigned.simulation.models.ritp_planner_model.RITPPlannerFeatureParams
  _convert_: 'all'
  # feature params
  radius: 300
  map_features: [LANE, LEFT_BOUNDARY, RIGHT_BOUNDARY, STOP_LINE, CROSSWALK, ROUTE_LANES]
  max_elements:
    LANE: null
    LEFT_BOUNDARY: null
    RIGHT_BOUNDARY: null
    STOP_LINE: null
    CROSSWALK: null
    ROUTE_LANES: null
  max_points:
    LANE: 20
    LEFT_BOUNDARY: 20
    RIGHT_BOUNDARY: 20
    STOP_LINE: 20
    CROSSWALK: 20
    ROUTE_LANES: 20
  agent_features: [VEHICLE, PEDESTRIAN, BICYCLE, TRAFFIC_CONE, BARRIER, CZONE_SIGN, GENERIC_OBJECT]
  max_agents:
    VEHICLE: null
    PEDESTRIAN: null
    BICYCLE: null
    TRAFFIC_CONE: null
    BARRIER: null
    CZONE_SIGN: null
    GENERIC_OBJECT: 10
  interpolation_method: linear
  num_past_steps: ${model.ritp_planner_feature_params.past_trajectory_sampling.num_poses}
  num_future_steps: ${model.ritp_planner_feature_params.future_trajectory_sampling.num_poses}
  past_trajectory_sampling:
    _target_: nuplan.planning.simulation.trajectory.trajectory_sampling.TrajectorySampling
    _convert_: 'all'
    num_poses: 49      # target past poses
    time_horizon: 4.9  # [s] time horizon of pase poses
  future_trajectory_sampling:
    _target_: nuplan.planning.simulation.trajectory.trajectory_sampling.TrajectorySampling
    _convert_: 'all'
    num_poses: 80     # target future poses
    time_horizon: 8.  # [s] time horizon of future poses


# ----------qcmae params----------
qcmae_model_params:
  _target_: nuplan_zigned.simulation.models.ritp_planner_model.QCMAEModelParams
  _convert_: 'all'
  input_dim: 2
  hidden_dim: 64
  output_dim: 2
  output_head: False  # whether the model output heading. if False, heading will be estimated by arctan(dy/dx)
  num_past_steps: ${model.qcmae_feature_params.past_trajectory_sampling.num_poses}
  num_future_steps: ${model.qcmae_target_params.future_trajectory_sampling.num_poses}
  num_modes: 6
  num_recurrent_steps: 4
  num_freq_bands: 64
  num_map_layers: 1
  num_agent_layers: 1
  num_dec_layers: 1
  num_heads: 8
  head_dim: 16
  dropout: 0.1
  pl2pl_radius: 150
  time_span: 10
  pl2a_radius: 50
  a2a_radius: 50
  num_t2m_steps: 30
  pl2m_radius: 150
  a2m_radius: 15
  pretrained_model_dir: null

qcmae_feature_params:
  _target_: nuplan_zigned.simulation.models.ritp_planner_model.QCMAEFeatureParams
  _convert_: 'all'
  # Map features
  dim: 3
  num_past_steps: ${model.qcmae_feature_params.past_trajectory_sampling.num_poses}
  num_future_steps: ${model.qcmae_target_params.future_trajectory_sampling.num_poses}
  radius: 150
  map_features: [LANE, LEFT_BOUNDARY, RIGHT_BOUNDARY, STOP_LINE, CROSSWALK, ROUTE_LANES]
  max_elements:
    LANE: 30
    LEFT_BOUNDARY: 30
    RIGHT_BOUNDARY: 30
    STOP_LINE: 20
    CROSSWALK: 20
    ROUTE_LANES: 30
  max_points:
    LANE: 20
    LEFT_BOUNDARY: 20
    RIGHT_BOUNDARY: 20
    STOP_LINE: 20
    CROSSWALK: 20
    ROUTE_LANES: 20
  predict_unseen_agents: False
  vector_repr: True
  interpolation_method: linear
  # Agent features
  agent_features: [VEHICLE, PEDESTRIAN, BICYCLE, TRAFFIC_CONE, BARRIER, CZONE_SIGN, GENERIC_OBJECT]
  max_agents:
    VEHICLE: 30
    PEDESTRIAN: 30
    BICYCLE: 30
    TRAFFIC_CONE: 30
    BARRIER: 30
    CZONE_SIGN: 30
    GENERIC_OBJECT: 10
  # Parameters for past trajectory
  past_trajectory_sampling:
    _target_: nuplan.planning.simulation.trajectory.trajectory_sampling.TrajectorySampling
    _convert_: 'all'
    num_poses: 49      # target past poses
    time_horizon: 4.9  # [s] time horizon of past poses

qcmae_target_params:
  _target_: nuplan_zigned.simulation.models.ritp_planner_model.QCMAETargetParams
  _convert_: 'all'
  agent_featrues: [VEHICLE, PEDESTRIAN, BICYCLE]
  num_past_steps: ${model.qcmae_feature_params.past_trajectory_sampling.num_poses}
  # Parameters for predicted trajectory
  future_trajectory_sampling:
    _target_: nuplan.planning.simulation.trajectory.trajectory_sampling.TrajectorySampling
    _convert_: 'all'
    num_poses: 80      # target future poses
    time_horizon: 8.0  # [s] time horizon of future poses